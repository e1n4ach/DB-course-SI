# Photo Studio Management System - Database Course Project

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ—Å—Ç—É–¥–∏–µ–π –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–π.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–ö–ª–∏–µ–Ω—Ç–∞–º–∏** ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏, –∫–æ–Ω—Ç–∞–∫—Ç—ã, –æ—Ç–º–µ—Ç–∫–∏ –æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–π** ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å—ã (–Ω–æ–≤–∞—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞, –æ—Ç–º–µ–Ω–µ–Ω–∞, –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
- **–ó–∞–ª–∞–º–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏, —É—á—ë—Ç –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∞–º–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏** ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–∞–≤–∫–∏, —Ä–æ–ª–∏
- **–¢–∞—Ä–∏—Ñ–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏** ‚Äî —Ç–∏–ø—ã —Å—ä—ë–º–∫–∏, —Ü–µ–Ω—ã, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏
- **–ü–ª–∞—Ç–µ–∂–∞–º–∏** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–ø–ª–∞—Ç –∏ —Å—Ç–∞—Ç—É—Å—ã

**–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:**
- **–ë–î:** PostgreSQL 13+
- **Backend:** Python 3.10+, FastAPI, SQLAlchemy ORM
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker, docker-compose
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:** Swagger/OpenAPI

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker & docker-compose
- Git

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

**1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
git clone https://github.com/e1n4ach/DB-course-SI.git
cd DB-course-SI/KP

**2. –ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**
docker-compose up -d


–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- PostgreSQL –Ω–∞ `localhost:5432`
- FastAPI –Ω–∞ `http://localhost:8000`

**3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**

–°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ:
1. `sql/schema.sql` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
2. `sql/functions.sql` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —Ç—Ä–∏–≥–≥–µ—Ä—ã
3. `sql/seed.sql` ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
4. `sql/explain_analyze.sql` ‚Äî –ø—Ä–∏–º–µ—Ä—ã EXPLAIN ANALYZE

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
docker exec -i photostudio-db psql -U postgres -d photostudio < sql/schema.sql
docker exec -i photostudio-db psql -U postgres -d photostudio < sql/functions.sql
docker exec -i photostudio-db psql -U postgres -d photostudio < sql/seed.sql


**4. –ü—Ä–æ–≤–µ—Ä—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞:**
curl http://localhost:8000/health

–†–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"ok"}


---

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Swagger UI:** [http://localhost:8000/docs](http://localhost:8000/docs)

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –ö–ª–∏–µ–Ω—Ç—ã
- `GET /api/clients/` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- `POST /api/clients/` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
- `GET /api/clients/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ ID
- `PUT /api/clients/{id}` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
- `DELETE /api/clients/{id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞

#### –ë—Ä–æ–Ω–∏ (Bookings)
- `GET /api/bookings/` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—Ä–æ–Ω–µ–π
- `POST /api/bookings/` ‚Äî —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω—å
- `GET /api/bookings/status/{status}` ‚Äî –±—Ä–æ–Ω–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É (new, confirmed, completed, cancelled)
- `GET /api/bookings/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω—å –ø–æ ID
- `PUT /api/bookings/{id}` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –±—Ä–æ–Ω—å
- `DELETE /api/bookings/{id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –±—Ä–æ–Ω—å

#### –ó–∞–ª—ã (Rooms)
- `GET /api/rooms/` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ª–æ–≤
- `GET /api/rooms/available` ‚Äî —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–ª—ã
- `GET /api/rooms/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–∞–ª –ø–æ ID

#### –û—Ç—á—ë—Ç—ã (Reports)
- `GET /api/reports/photographer-income?start_date=2025-12-01&end_date=2025-12-31` ‚Äî –≤—ã—Ä—É—á–∫–∞ –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞–º
- `GET /api/reports/room-usage?start_date=2025-12-01&end_date=2025-12-31` ‚Äî –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å –∑–∞–ª–æ–≤
- `GET /api/reports/problem-clients` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- `GET /api/reports/upcoming-bookings` ‚Äî –±–ª–∏–∂–∞–π—à–∏–µ –±—Ä–æ–Ω–∏
- `GET /api/reports/room-revenue` ‚Äî –≤—ã—Ä—É—á–∫–∞ –ø–æ –∑–∞–ª–∞–º
- `GET /api/reports/popular-packages` ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- `GET /api/reports/audit-log?limit=100` ‚Äî –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞

#### –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- `POST /api/import/clients-csv` ‚Äî –∏–º–ø–æ—Ä—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ CSV
- `POST /api/import/bookings-csv` ‚Äî –∏–º–ø–æ—Ä—Ç –±—Ä–æ–Ω–µ–π –∏–∑ CSV





(venv) levian@DESKTOP-DFOO1AK:/mnt/c/Users/levi/programming/DB-course-SI/KP$ docker exec photostudio-db psql -U postgres -d photostudio << 'SQL'
> -- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
 'Book> SELECT
>     'Bookings with valid clients' as check_name,
DISTINC>     COUNT(DISTINCT b.client_id) as count
 b
JOIN > FROM bookings b
c ON b.c> JOIN clients c ON b.client_id = c.id;

SELECT >
> SELECT
Bookings>     'Bookings with valid photographers' as check_name,
NT(DIST>     COUNT(DISTINCT b.photographer_id) as count
> FROM bookings b
 staff s> JOIN staff s ON b.photographer_id = s.id;
>
> SELECT
>     'Bookings with valid rooms' as check_name,
>     COUNT(DISTINCT b.room_id) as count
ROM bookings b
J> FROM bookings b
> JOIN studio_rooms r ON b.room_id = r.id;
   'Eq>
uipmen> SELECT
>     'Equipment with valid rooms' as check_name,
>     COUNT(DISTINCT e.room_id) as count
> FROM equipment e
> JOIN studio_rooms r ON e.room_id = r.id
> WHERE e.room_id IS NOT NULL;
>
> SELECT
>     'Payments linked to bookings' as check_name,
>     COUNT(DISTINCT p.booking_id) as count
ayments > FROM payments p
> JOIN bookings b ON p.booking_id = b.id;
> SQL
(venv) levian@DESKTOP-DFOO1AK:/mnt/c/Users/levi/programming/DB-course-SI/KP$ docker exec photostudio-db psql -U postgres -d photostudio -c "
ECT 'B> SELECT 'Bookings with valid clients' as check_name, COUNT(DISTINCT b.client_id) as count FROM bookings b JOIN clients c ON b.client_id = c.id;
'Booking> SELECT 'Bookings with valid photographers', COUNT(DISTINCT b.photographer_id) FROM bookings b JOIN staff s ON b.photographer_id = s.id;
> SELECT 'Bookings with valid rooms', COUNT(DISTINCT b.room_id) FROM bookings b JOIN studio_rooms r ON b.room_id = r.id;
> SELECT 'Equipment with valid rooms', COUNT(DISTINCT e.room_id) FROM equipment e JOIN studio_rooms r ON e.room_id = r.id WHERE e.room_id IS NOT NULL;
> SELECT 'Payments linked to bookings', COUNT(DISTINCT p.booking_id) FROM payments p JOIN bookings b ON p.booking_id = b.id;
> "
         check_name          | count 
-----------------------------+-------
 Bookings with valid clients |   100
(1 row)

             ?column?              | count
-----------------------------------+-------
 Bookings with valid photographers |    20
(1 row)

         ?column?          | count
---------------------------+-------
 Bookings with valid rooms |     8
(1 row)

          ?column?          | count
----------------------------+-------
 Equipment with valid rooms |     8
(1 row)

          ?column?           | count 
-----------------------------+-------
 Payments linked to bookings |   250
(1 row)

(venv) levian@DESKTOP-DFOO1AK:/mnt/c/Users/levi/programming/DB-course-SI/KP$ docker exec photostudio-db psql -U postgres -d photostudio -c "
ample Bo> SELECT 'Sample Bookings' as section;
first_n> SELECT b.id, c.first_name, s.first_name as photographer, r.name as room, b.session_date, b.total_price 
 booking> FROM bookings b
> JOIN clients c ON b.client_id = c.id 
aff s ON> JOIN staff s ON b.photographer_id = s.id 
ms r ON > JOIN studio_rooms r ON b.room_id = r.id
> LIMIT 5;
>
> SELECT '' as blank;
> SELECT 'Sample Equipment' as section;
CT e.id,> SELECT e.id, e.name, e.equipment_type, e.status, r.name as room 
quipment> FROM equipment e
> JOIN studio_rooms r ON e.room_id = r.id 
> LIMIT 5;
>
> SELECT '' as blank;
> SELECT 'Sample Payments' as section;
> SELECT p.id, b.id as booking_id, p.amount, p.payment_method, p.status 
> FROM payments p
> JOIN bookings b ON p.booking_id = b.id 
> LIMIT 5;
> "
     section     
-----------------
 Sample Bookings
(1 row)

 id | first_name | photographer |   room   | session_date | total_price
----+------------+--------------+----------+--------------+-------------
  1 | Client2    | Staff2       | Studio B | 2025-12-08   |     5100.00
  2 | Client3    | Staff3       | Studio C | 2025-12-09   |     5200.00
  3 | Client4    | Staff4       | Studio D | 2025-12-10   |     5300.00
  4 | Client5    | Staff5       | Studio E | 2025-12-11   |     5400.00
  5 | Client6    | Staff6       | Studio F | 2025-12-12   |     5500.00
(5 rows)

 blank
-------

(1 row)

     section
------------------
 Sample Equipment
(1 row)

 id |    name     | equipment_type |   status    |   room
----+-------------+----------------+-------------+----------
  1 | Equipment 1 | lens           | maintenance | Studio B
  2 | Equipment 2 | light          | broken      | Studio C
  3 | Equipment 3 | tripod         | working     | Studio D
  4 | Equipment 4 | reflector      | maintenance | Studio E
  5 | Equipment 5 | backdrop       | broken      | Studio F
(5 rows)

 blank
-------

(1 row)

     section
-----------------
 Sample Payments
(1 row)

 id | booking_id | amount  | payment_method |  status
----+------------+---------+----------------+-----------
  1 |          2 | 5050.00 | cash           | pending
  2 |          3 | 5100.00 | transfer       | completed
  3 |          4 | 5150.00 | card           | pending
  4 |          5 | 5200.00 | cash           | completed
  5 |          6 | 5250.00 | transfer       | pending
(5 rows)
